name: All fields tested

app_spec:
  image: "busybox:latest"
  probes:
    liveness:
    readiness:
    startup:
  ports:
    - kind: http
      port: 8080
    - kind: metrics
      port: 9090
    - kind: tcp
      port: 1234

operations:
  - operation: CreateOrUpdate
    object:
      apiVersion: apps/v1
      kind: Deployment
      metadata:
        labels:
          app.kubernetes.io/managed-by: yakup
          app.kubernetes.io/name: test-app
        name: test-app
        namespace: default
      spec:
        replicas: 1
        selector:
          matchLabels:
            app.kubernetes.io/managed-by: yakup
            app.kubernetes.io/name: test-app
        template:
          metadata:
            labels:
              app.kubernetes.io/managed-by: yakup
              app.kubernetes.io/name: test-app
          spec:
            containers:
              - image: 'busybox:latest'
                name: test-app
                livenessProbe:
                  failureThreshold: 3
                  httpGet:
                    path: /
                    port: 13133
                    scheme: HTTP
                  periodSeconds: 10
                  successThreshold: 1
                  timeoutSeconds: 1
                readinessProbe:
                  failureThreshold: 3
                  httpGet:
                    path: /
                    port: 13133
                    scheme: HTTP
                  periodSeconds: 10
                  successThreshold: 1
                  timeoutSeconds: 1
                startupProbe:
                  failureThreshold: 3
                  httpGet:
                    path: /
                    port: 13133
                    scheme: HTTP
                  periodSeconds: 10
                  successThreshold: 1
                  timeoutSeconds: 1
                ports:
                  - name: http
                    containerPort: 8080
                  - name: metrics
                    containerPort: 9090
                  - name: tcp
                    containerPort: 1234
                envFrom:
                  - configMapRef:
                      name: test-app
                      optional: true
                  - secretRef:
                      name: test-app
                      optional: true
                volumeMounts:
                  - mountPath: /var/run/config/yakup.ibidem.no/test-app
                    name: test-app-configmap
                    readOnly: true
                  - mountPath: /var/run/secrets/yakup.ibidem.no/test-app
                    name: test-app-secret
                    readOnly: true
            volumes:
              - configMap:
                  name: test-app
                  optional: true
                  defaultMode: 0o644
                name: test-app-configmap
              - secret:
                  secretName: test-app
                  optional: true
                  defaultMode: 0o644
                name: test-app-secret
  - operation: CreateOrUpdate
    object:
      apiVersion: v1
      kind: Service
      metadata:
        labels:
          app.kubernetes.io/managed-by: yakup
          app.kubernetes.io/name: test-app
        name: test-app
        namespace: default
      spec:
        ports:
          - name: http
            port: 80
            targetPort: http
          - name: metrics
            port: 9090
            targetPort: metrics
          - name: tcp
            port: 1234
            targetPort: tcp
        selector:
          app.kubernetes.io/managed-by: yakup
          app.kubernetes.io/name: test-app
